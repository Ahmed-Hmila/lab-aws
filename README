# README - SimpleFastPyAPI

## ğŸ“¦ Architecture

```
CLIENT
  |
  v
API GATEWAY
 â”œâ”€â”€ POST /submit  â”€â”€â”€â–¶  SQS  â”€â”€â”€â–¶  Lambda (async)
 â”œâ”€â”€ GET  /users    â”€â”€â”€â–¶  Lambda (sync)
 â”œâ”€â”€ POST /users    â”€â”€â”€â–¶  Lambda (sync)
 â”œâ”€â”€ PUT  /users/{id} â”€â–¶  Lambda (sync)
 â””â”€â”€ DELETE /users/{id} â”€â–¶  Lambda (sync)
```

* **POST /submit** : envoie des messages Ã  SQS
* **/users** : CRUD sur les utilisateurs
* **Lambda + Mangum** : permet Ã  FastAPI de tourner sur AWS Lambda
* **Terraform** : dÃ©ploie API Gateway, Lambda, SQS, IAM roles

## âš™ï¸ Variables Terraform importantes

* `queue_name` : nom de la file SQS
* `api_gateway_arn` : ARN de lâ€™API Gateway pour la politique SQS
* `lambda_arn` : ARN de la Lambda
* `apigw_sqs_role_arn` : ARN du rÃ´le IAM pour permettre Ã  API Gateway dâ€™envoyer des messages Ã  SQS

## ğŸš€ DÃ©ploiement

1. Initialiser Terraform :

```bash
terraform init
```

2. Planifier le dÃ©ploiement :

```bash
terraform plan
```

3. Appliquer le dÃ©ploiement :

```bash
terraform apply
```

## ğŸ”— Endpoints et test avec cURL

DÃ©finir lâ€™URL de base :

```bash
BASE_URL=https://<ton-api-id>.execute-api.eu-west-3.amazonaws.com/prod
```

### 1ï¸âƒ£ GET /users

```bash
curl -i $BASE_URL/users/
```

* Retourne la liste des utilisateurs.

### 2ï¸âƒ£ GET /users/{id}

```bash
curl -i $BASE_URL/users/1
```

* Retourne lâ€™utilisateur avec lâ€™ID 1.

### 3ï¸âƒ£ POST /users

```bash
curl -i -X POST $BASE_URL/users/ \
-H "Content-Type: application/json" \
-d '{
  "name": "Alice",
  "email": "alice@example.com",
  "password": "password1"
}'
```

* CrÃ©e un nouvel utilisateur.

### 4ï¸âƒ£ PUT /users/{id}

```bash
curl -i -X PUT $BASE_URL/users/1 \
-H "Content-Type: application/json" \
-d '{
  "name": "Alice Updated",
  "email": "alice-updated@example.com"
}'
```

* Met Ã  jour lâ€™utilisateur avec lâ€™ID 1.

### 5ï¸âƒ£ DELETE /users/{id}

```bash
curl -i -X DELETE $BASE_URL/users/1
```

* Supprime lâ€™utilisateur avec lâ€™ID 1.

### 6ï¸âƒ£ POST /submit (SQS)

```bash
curl -i -X POST $BASE_URL/submit \
-H "Content-Type: application/json" \
-d '{
  "type": "user_created",
  "user_id": 123,
  "email": "test@test.com"
}'
```

* Envoie un message Ã  SQS.
* VÃ©rifier dans AWS SQS que le message est bien reÃ§u.

 
